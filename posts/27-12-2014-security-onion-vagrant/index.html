<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Narkisr.com: Security onion vagrant</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" >
    <!-- <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css"> -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/default.min.css">
        <link href="/css/screen.css" rel="stylesheet" type="text/css" />
	  <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	  <link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">

            <div class="navbar-header">

                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
			  <span class="icon-bar"></span>
			</button>
		    </div>

				    <!-- nav links -->
		    <div id="navbar" class="navbar-collapse collapse">
			<ul class="nav navbar-nav">
			  <li ><a href="/">Home</a></li>
			  <li ><a href="/archives/">Archives</a></li>
			  
			  <li >
			  <a href="/pages/projects/">Projects</a>
			  </li>
			  
			  <li >
			  <a href="/pages/presentations/">Presentations</a>
			  </li>
			  
			  <ul class="nav navbar-nav navbar-right">
			    <li><a class="btn" href=/atom.xml ><i class="fa fa-rss"></i></a></li>
			    <li><a class="btn" href="http://twitter.com/narkisr" ><i class="fa fa-twitter"></i></a></li>
			    <li><a class="btn" href="https://github.com/narkisr" ><i class="fa fa-github-alt"></i></a></li>
			    <li><a class="btn" href="http://il.linkedin.com/in/narkisr/" ><i class="fa fa-linkedin"></i></a></li>
			  </ul>


			</ul>
		    </div><!--/.nav-collapse -->
		  </div>
		</nav>

		<div id="wrapper" class="container">
		  <div class="row">
		    <div class="col-md-8">
			<div id="content">
			  
<div id="post">
    <div id="post-header">
    <h2>Security onion vagrant</h2>
    <div id="post-meta">
        
        <div class="date">December 27, 2014</div>
    </div>
</div>
<div>
    
    <h3 id="intro">Intro</h3><p>Setting up <a href='http://en.wikipedia.org/wiki/Intrusion_detection_system'>IDS</a> systems such as <a href='https://www.snort.org/'>snort</a> has always been a tedious task, <a href='http://blog.securityonion.net/p/securityonion.html'>Security onion</a> (or SO for short) is a solution that aims to change that.</p><p>It includes not only snort but also <a href='http://www.ossec.net/'>ossec</a> (a HIDS system), <a href='https://code.google.com/p/enterprise-log-search-and-archive/'>ELSA</a> for central logging management, <a href='https://www.snorby.org/'>Snorby</a> a dashboard for IDS events. </p><p>SO publishes a <a href='https://launchpad.net/~securityonion/+archive/ubuntu/stable'>PPA</a> which is Ubuntu 12.04 compatible and distributes a livecd <a href='http://sourceforge.net/projects/security-onion/'>ISO</a> for setting it up on physical machines.</p><p>In this post ill go through on how to setup SO vagrant box, enabling us to do fast iterations and provisioning development.</p><h4 id="box&#95;setup">BOX setup</h4><p>The first step is creating the SO box itself using <a href='https://www.packer.io/'>packer</a>:</p><pre><code class="bash">$ git clone git://github.com/narkisr/packer-security-onion.git 
# won't work on a headless machine
$ make virtualbox/security-onion-12.04.4  
</code></pre><p>The box itself is quite heavily customized due to the requirements of SO, once the box was created we import it like any other:</p><pre><code class="bash">$ vagrant box add security-onion-12.04.4&#95;puppet-3.7.3 box/virtualbox/security-onion-12.04.4&#95;puppet&#95;3.7.3.box
</code></pre><p>Now we are ready to start rolling vagrant.</p><h4 id="vagrant">Vagrant</h4><p>Perquisites:</p><ul><li><a href='https://github.com/opskeleton/opskeleton'>Opskeleton</a> defines the project layout of the following Vagrant/Puppet code base so make sure to <a href='https://github.com/opskeleton/opskeleton#installation'>have</a>.</li><li>SO itself requires a running GUI (so no headless servers).</li><li>Have a mirror port ready on your switch connected to a physical interface (if you want to capture meaningful traffic), note that you can customize the mirror port vagrant uses (using VAGRANT_MIRROR).</li></ul><pre><code class="bash">$ git clone git://github.com/opskeleton/security-onion-sandbox.git
# Wont work on a headless machine
$ gem install bundle
$ bundle install
$ librarian-puppet install
# in order to customize mirror port use VAGRANT&#95;MIRROR=ifc
$ vagrant up
</code></pre><p>Once the VM UI is running enter a terminal and start sosetup:</p><pre><code class="bash">$ sosetup
</code></pre><p>On its first invocation the wizard will guide you through the network setup, choose eth0 as the management interface and eth1 as the monitor interface, reboot once done.</p><p>Once the machine is up run sosetup again to setup Sguil and Snorby u/p</p><pre><code class="bash">$ sosetup
</code></pre><p>Once done you can either head on to <a href='https://localhost'>localhost</a> (from within the VM) or from the host use the forwarded ports <a href='https://localhost:8444'>snorby</a>.</p><h4 id="footnotes:">Footnotes:</h4><ul><li><small> Sadly automating the setup wizard using Puppet didn't workout, you can pass an answer file but the text based wizard does not work proprerly while being ran from the Puppet exec call. </small></li><li><small> openssh server didn't work well so the vagrant box is using dropbear instead.</small></li></ul>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/security/">security</a>
    
    <a href="/opskeleton/">opskeleton</a>
    
    <a href="/vagrant/">vagrant</a>
    
</div>

    <div id="prev-next">
        
        <a href="/posts/16-04-2016-pi-crypt/">&laquo; PI crypt</a>
        
        
        ||
        
        
        <a href="/posts/18-05-2013-node-cljs/">Nodifying Clojure &raquo;</a>
        
    </div>

</div>

			</div>
		    </div>

		    <div class="col-md-3">
			<div id="sidebar">
			  <ul id="links">

			    
			    <li><a href="/pages/about/">About</a></li>
			    
			  </ul>
			  <div id="recent">
			    <h3>Recent Posts</h3>
			    <ul>
				
				<li><a href="/posts/27-04-2020-clara-flow/">Rules, not what you recall</a></li>
				
				<li><a href="/posts/20-02-2018-wacky/">Speculative execution</a></li>
				
				<li><a href="/posts/04-02-2018-types-mismatch/">When types are eating away your sanity</a></li>
				
			    </ul>
			  </div>
			  <div id="tags">
			    <h3>Tags</h3>
			    <ul>
				
				<li><a href="/js/">js</a></li>
				
				<li><a href="/security/">security</a></li>
				
				<li><a href="/dependencies/">dependencies</a></li>
				
				<li><a href="/raspberry/">raspberry</a></li>
				
				<li><a href="/encryption/">encryption</a></li>
				
				<li><a href="/cyanogenmod/">cyanogenmod</a></li>
				
				<li><a href="/wifi/">wifi</a></li>
				
				<li><a href="/design/">design</a></li>
				
				<li><a href="/asus/">asus</a></li>
				
				<li><a href="/opskeleton/">opskeleton</a></li>
				
				<li><a href="/tf101/">tf101</a></li>
				
				<li><a href="/management/">management</a></li>
				
				<li><a href="/software/">software</a></li>
				
				<li><a href="/linux/">linux</a></li>
				
				<li><a href="/types/">types</a></li>
				
				<li><a href="/pi/">pi</a></li>
				
				<li><a href="/re-core/">re-core</a></li>
				
				<li><a href="/Clojure/">Clojure</a></li>
				
				<li><a href="/vagrant/">vagrant</a></li>
				
				<li><a href="/concurrency/">concurrency</a></li>
				
				<li><a href="/re-ops/">re-ops</a></li>
				
				<li><a href="/clara/">clara</a></li>
				
				<li><a href="/functional/">functional</a></li>
				
				<li><a href="/future/">future</a></li>
				
				<li><a href="/re-mote/">re-mote</a></li>
				
				<li><a href="/impedance/">impedance</a></li>
				
				<li><a href="/android/">android</a></li>
				
				<li><a href="/raspberry-pi/">raspberry-pi</a></li>
				
				<li><a href="/nodejs/">nodejs</a></li>
				
				<li><a href="/flows/">flows</a></li>
				
				<li><a href="/operations/">operations</a></li>
				
			    </ul>
			  </div>
			</div>
		    </div>
		  </div>
		  <footer class="footer"><div class="span-24 small quite last">
			<span href="http://purl.org/dc/dcmitype/Text" property="dc:title" rel="dc:type" xmlns:dc="http://purl.org/dc/elements/1.1/"> This website content</span> by <a href="narkisr.com" property="cc:attributionName" rel="cc:attributionURL" xmlns:cc="http://creativecommons.org/ns#"> Ronen Narkis </a> is licensed under a <a href="http://creativecommons.org/licenses/by/2.5/il/" rel="license">Creative Commons Attribution 2.5 Israel License</a>, based on a work at <a href="narkisr.com" rel="dc:source" xmlns:dc="http://purl.org/dc/elements/1.1/">narkisr.com</a>, Permissions beyond the scope of this license may be available at <a href="narkisr.com" rel="cc:morePermissions" xmlns:cc="http://creativecommons.org/ns#">narkisr.com</a>.</div>
		  </footer>
		</div>
		<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
		<script src="/js/highlight.pack.js" type="text/javascript"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	    </body>
	  </html>

