<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Narkisr.com: Speculative execution</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" >
    <!-- <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css"> -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/default.min.css">
        <link href="/css/screen.css" rel="stylesheet" type="text/css" />
	  <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	  <link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">

            <div class="navbar-header">

                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
			  <span class="icon-bar"></span>
			</button>
		    </div>

				    <!-- nav links -->
		    <div id="navbar" class="navbar-collapse collapse">
			<ul class="nav navbar-nav">
			  <li ><a href="/">Home</a></li>
			  <li ><a href="/archives/">Archives</a></li>
			  
			  <li >
			  <a href="/pages/projects/">Projects</a>
			  </li>
			  
			  <li >
			  <a href="/pages/presentations/">Presentations</a>
			  </li>
			  
			  <ul class="nav navbar-nav navbar-right">
			    <li><a class="btn" href=/atom.xml ><i class="fa fa-rss"></i></a></li>
			    <li><a class="btn" href="http://twitter.com/narkisr" ><i class="fa fa-twitter"></i></a></li>
			    <li><a class="btn" href="https://github.com/narkisr" ><i class="fa fa-github-alt"></i></a></li>
			    <li><a class="btn" href="http://il.linkedin.com/in/narkisr/" ><i class="fa fa-linkedin"></i></a></li>
			  </ul>


			</ul>
		    </div><!--/.nav-collapse -->
		  </div>
		</nav>

		<div id="wrapper" class="container">
		  <div class="row">
		    <div class="col-md-8">
			<div id="content">
			  
<div id="post">
    <div id="post-header">
    <h2>Speculative execution</h2>
    <div id="post-meta">
        
        <div class="date">20 February 2018</div>
    </div>
</div>
<div>
    
    <h3 id="intro">Intro</h3><p>One of the characteristics of good tools is that they allow creative exploration of ideas, in this post ill cover some speculative flows that Re-ops may support in the future.</p><p>The flows are not implemented but Re-ops makes them all possible due to its basic architecture and design.</p><h2 id="voice&#95;up">Voice up</h2><p>There are a lot of cases where it makes sense to create/start a VM/Physical machine, lets take for example your media server, or a remote development machine, we need those only on specific times yet we usually run them 24/7, but what if we could trigger them based on our needs?</p><pre><code class="clojure">&#40;defn plex-on &#91;&#93;
  &#40;run &#40;start&#41; | &#40;alexa :reply &quot;ok&quot;&#41;&#41;&#41;

&#40;defn update-all &#91;&#93;
  &#40;run &#40;update&#41; | &#40;alexa :reply &quot;ok&quot;&#41;&#41;

; start VM instances by saying 'Alexa start plex on'
&#40;wemo &#40;alexa :event &quot;plex power on&quot;&#41; &#40;plex-on&#41;&#41;

; updating all the machine by saying 'Alexa update all'
&#40;wemo &#40;alexa :event &quot;update all&quot;&#41; &#40;update-all&#41;&#41;

</code></pre><p>Now this flow isn't implemented now, I suspect it should pretty easy to implement by exposing a WeMO like interface and pretending to be one or more devices.</p><p>Another good options (tough it will require a bit more setup) is to use MQTT, the main issue here is exposing the MQTT broker to Alexa.</p><h2 id="sensors">Sensors</h2><p>Another cool idea is to integrate Re-ops with sensors:</p><pre><code class="clojure">; our closet instances &#40;including the physical hypervisor big-iron&#41;
&#40;def closet &#40;Hosts. {} &#91;&quot;foo&quot; &quot;bar&quot; &quot;big-iron&quot;&#93;&#41;&#41;

; Stopping our closet instances when it gets too hot &#40;beyond 70c&#41;
&#40;def check-temp &#91;t&#93;
  &#40;when &#40;&gt; t 70&#41;
    &#40;run &#40;stop hs&#41; | &#40;email to-from &quot;stopped all closed instances, room too hot&quot;&#41;&#41;

&#40;watch :temp once-an-hour &#40;check-temp &#40;sensor :temperture&#41;&#41;

</code></pre><p>Here we would stop all the VM's and the hosts if our server room (aka our closet) gets too hot thus preventing hardware meltdown while we are not near, we would need to exposing an MQTT end point and the rest should be pretty easy to follow.</p><p>A more far out scenario is automating our machines based on sensor detecting power output from solar panels (is it sunny enough or not) if there isn't enough power draw we would rather not to use costly energy from the wall, our mining farm will start/stop based on the power costs:</p><pre><code class="clojure">; our mining instances &#40;including the hypervisor big-iron&#41;
&#40;def mining-pool &#40;Hosts. {} &#91;&quot;coin-1&quot; &quot;coin-1&quot; &quot;big-iron&quot;&#93;&#41;&#41;

; We produce more then 10KW of power lets start mining
&#40;defn power-ok &#91;&#93;
   &#40;run &#40;start mining-pool&#41; | &#40;pretty &quot;pool resumed&quot;&#41;&#41;

; We produce less then 10KW of power lets stop mining
&#40;defn low-power &#91;&#93;
  &#40;run &#40;stop mining-pool&#41; | &#40;pretty &quot;pool stopped&quot;&#41;&#41;

&#40;defn adjust-pool &#91;&#93;
  &#40;if &#40;&gt; &#40;check-power&#41; 10&#41;&#41;
     &#40;power-ok&#41;
     &#40;low-power&#41;&#41;

&#40;watch :power-check once-an-hour adjust-pool&#41;

</code></pre><h2 id="scanning">Scanning</h2><p>Running a scanning tool on a regular basis is a good way for checking compliance and detect potential security issues:</p><pre><code class="clojure">
&#40;def suspicious-ports #{25 ...}&#41;
&#40;def scanner &#40;Hosts. {} &#91;&quot;scanner&quot;&#93;&#41;&#41;

&#40;defn scan &#91;&#93;
  &#40;run &#40;open-ports scanner&#41; | &#40;pick &#40;fn &#91;ports&#93; &#40;suspicious-ports ports&#41;&#41;&#41; | &#40;email &quot;suspicious ports found&quot;&#41;&#41;

&#40;watch :nmap &#40;every-day 22&#41; &#40;scan hosts&#41;&#41;

</code></pre><p>Using the scanner from a dedicated host enables us to:</p><ul><li>Selectively allow password-less sudo access instance for the specific VM.</li><li>Have scanning agents running within segmented networks, thus controlling which ports/networks are exposed.</li></ul><h2 id="spot&#95;instances">Spot instances</h2><p>In AWS we can bid for EC2 instances and offer a max price that we are willing to pay for them, for some workloads (like batch processing) this can be highly cost effective.</p><p>The main down side is that we do this bidding only within EC2, what if we could have a cost decision tree that makes a dynamic decision whether to use one provide or another:</p><pre><code class="clojure">; some long batch job
&#40;def batch &#40;Hosts. {} &#91;&quot;worker-1&quot; &quot;worker-2&quot; &quot;master&quot;&#93;&#41;&#41;

; AWS cost per hour bellow $0.0058 per Hour
&#40;defn use-ec2 &#91;&#93;
  &#40;run &#40;destroy batch&#41; | &#40;create batch aws-spot-instance&#41;&#41;&#41;


; AWS too expansive we will run locally
&#40;defn use-kvm &#91;c&#93;
  &#40;run &#40;destroy batch&#41; | &#40;create batch kvm-medium&#41;&#41;&#41;

&#40;defn pick &#91;&#93;
   &#40;if &#40;&lt; &#40;cost :ec2-cost&#41; 0.0058&#41;
     &#40;use-ec2&#41;
     &#40;use-kvm&#41;&#41;&#41;

; The cost changes will be collected once an hour so we won't flap too often.
&#40;watch :aws-spots once-an-hour pick&#41;

</code></pre><h2 id="summary">Summary</h2><p>In this post we explored some of the more speculative (yet possible) flows that Re-ops can enable, having a flexible and fully programmable tool can really lead to interesting ideas and implementation.</p><h4 id="footnotes:">Footnotes:</h4><ul><li><small><a href='http://www.belkin.com/au/Products/home-automation/c/wemo-home-automation/'>WeMo</a> home automation.</small></li><li><small><a href='http://mqtt.org/'>MQTT</a> protocol,</small></li><li><small>AWS <a href='https://aws.amazon.com/ec2/spot/'>Spot</a> instances</small></li></ul>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/re-core/">re-core</a>
    
    <a href="/re-ops/">re-ops</a>
    
    <a href="/functional/">functional</a>
    
    <a href="/re-mote/">re-mote</a>
    
    <a href="/flows/">flows</a>
    
    <a href="/operations/">operations</a>
    
</div>

    <div id="prev-next">
        
        
        
        <a href="/posts/04-02-2018-types-mismatch/">When types are eating away your sanity &raquo;</a>
        
    </div>

</div>

			</div>
		    </div>

		    <div class="col-md-3">
			<div id="sidebar">
			  <ul id="links">

			    
			    <li><a href="/pages/about/">About</a></li>
			    
			  </ul>
			  <div id="recent">
			    <h3>Recent Posts</h3>
			    <ul>
				
				<li><a href="/posts/20-02-2018-wacky/">Speculative execution</a></li>
				
				<li><a href="/posts/04-02-2018-types-mismatch/">When types are eating away your sanity</a></li>
				
				<li><a href="/posts/17-01-2018-dependencies/">The balancing game</a></li>
				
			    </ul>
			  </div>
			  <div id="tags">
			    <h3>Tags</h3>
			    <ul>
				
				<li><a href="/js/">js</a></li>
				
				<li><a href="/security/">security</a></li>
				
				<li><a href="/dependencies/">dependencies</a></li>
				
				<li><a href="/raspberry/">raspberry</a></li>
				
				<li><a href="/encryption/">encryption</a></li>
				
				<li><a href="/cyanogenmod/">cyanogenmod</a></li>
				
				<li><a href="/wifi/">wifi</a></li>
				
				<li><a href="/design/">design</a></li>
				
				<li><a href="/asus/">asus</a></li>
				
				<li><a href="/opskeleton/">opskeleton</a></li>
				
				<li><a href="/tf101/">tf101</a></li>
				
				<li><a href="/management/">management</a></li>
				
				<li><a href="/software/">software</a></li>
				
				<li><a href="/linux/">linux</a></li>
				
				<li><a href="/types/">types</a></li>
				
				<li><a href="/pi/">pi</a></li>
				
				<li><a href="/re-core/">re-core</a></li>
				
				<li><a href="/Clojure/">Clojure</a></li>
				
				<li><a href="/vagrant/">vagrant</a></li>
				
				<li><a href="/concurrency/">concurrency</a></li>
				
				<li><a href="/re-ops/">re-ops</a></li>
				
				<li><a href="/functional/">functional</a></li>
				
				<li><a href="/future/">future</a></li>
				
				<li><a href="/re-mote/">re-mote</a></li>
				
				<li><a href="/impedance/">impedance</a></li>
				
				<li><a href="/android/">android</a></li>
				
				<li><a href="/raspberry-pi/">raspberry-pi</a></li>
				
				<li><a href="/nodejs/">nodejs</a></li>
				
				<li><a href="/flows/">flows</a></li>
				
				<li><a href="/operations/">operations</a></li>
				
			    </ul>
			  </div>
			</div>
		    </div>
		  </div>
		  <footer class="footer"><div class="span-24 small quite last">
			<span href="http://purl.org/dc/dcmitype/Text" property="dc:title" rel="dc:type" xmlns:dc="http://purl.org/dc/elements/1.1/"> This website content</span> by <a href="narkisr.com" property="cc:attributionName" rel="cc:attributionURL" xmlns:cc="http://creativecommons.org/ns#"> Ronen Narkis </a> is licensed under a <a href="http://creativecommons.org/licenses/by/2.5/il/" rel="license">Creative Commons Attribution 2.5 Israel License</a>, based on a work at <a href="narkisr.com" rel="dc:source" xmlns:dc="http://purl.org/dc/elements/1.1/">narkisr.com</a>, Permissions beyond the scope of this license may be available at <a href="narkisr.com" rel="cc:morePermissions" xmlns:cc="http://creativecommons.org/ns#">narkisr.com</a>.</div>
		  </footer>
		</div>
		<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
		<script src="/js/highlight.pack.js" type="text/javascript"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	    </body>
	  </html>

