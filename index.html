<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Narkisr.com</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" >
    <!-- <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css"> -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/default.min.css">
        <link href="css/screen.css" rel="stylesheet" type="text/css" />
	  <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	  <link href="css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">

            <div class="navbar-header">

                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
			  <span class="icon-bar"></span>
			</button>

		    </div>
		    <ul class="nav navbar-nav navbar-right">
			<li><a class="btn" href=/atom.xml ><i class="fa fa-rss"></i></a></li>
			<li><a class="btn" href="http://twitter.com/narkisr" ><i class="fa fa-twitter"></i></a></li>
			<li><a class="btn" href="https://github.com/narkisr" ><i class="fa fa-github-alt"></i></a></li>
			<li><a class="btn" href="http://il.linkedin.com/in/narkisr/" ><i class="fa fa-linkedin"></i></a></li>
                  <li><a class="btn" href="/pages/about" >
                    <img style='border-radius: 50%;'  src="/img/me-small.jpg" height="60%" width="60%"/></a>
                  </li>
		    </ul>
		    <!-- nav links -->
		    <div id="navbar" class="navbar-collapse collapse">
			<ul class="nav navbar-nav">
			  <li  class="active" ><a href="/">Home</a></li>
			  <li ><a href="/archives/">Archives</a></li>
			  
			  <li >
			  <a href="/pages/projects/">Projects</a>
			  </li>
			  
			  <li >
			  <a href="/pages/presentations/">Presentations</a>
			  </li>
			  
			</ul>
		    </div><!--/.nav-collapse -->
		  </div>
		</nav>

		<div id="wrapper" class="container">
		  <div class="row">
		    <div class="col-md-8">
			<div id="content">
			  
<div id="post">
    <div id="post-header">
    <h2>When types are eating away your sanity</h2>
    <div id="post-meta">
        
        <div class="date">4 February 2018</div>
    </div>
</div>
<div>
    
    <h3 id="intro">Intro</h3><p>Iv been programming in Java for more than 15 years and in every project I kept seeing the same pattern:</p><pre><code class="java">public class PersonTo {
  public String name;
  public Integer age;
}

public class PersonModel {
  public String name;
  public Integer age;
  public boolean isRegistered;
}

public class ServiceA {

  public void personsService&#40;String json&#41;{
   PersonTo person = parse&#40;json&#41;;
   PersonModel model = process&#40;person&#41;;
   persist&#40;model&#41;;
  }
}

</code></pre><p>If you lucky you have a set of conversion logic in place (iv seen a lot of duplicated code that ignores the issue and just copy and past the same logic):</p><pre><code class="java">public class PersonToConvertor&lt;PersonModel&gt; {
   public PersonModel convert&#40;PersonTo person&#41; {
    //.. the pleasure of conversion logic
    return personModel;
   }
}
public class PersonModelConvertor&lt;PersonTo&gt; {
   public PersonTo convert&#40;PersonModel person&#41; {
    //.. the pleasure of conversion logic
    return personTo;
   }
}
</code></pre><p>We have a simple json -> PersonTo -> PersonModel conversion chain, why we have those conversions? because each part of the system expect to get the data in a certain shape and form and because its better OOP modeling.</p><p>Still this is a simple example and you can imagine the piles and piles of code that deals with this issue, it does not matter if your programming in Java/Haskell/Go/Elm at the end of the day slurping data into your system will cost you.</p><p>Not only that but if the data types/structure changes you may find yourself in a huge refactoring and moving/shaking a lot of types/methods/functions around (a ripple effect).</p><p>But wait, is there an alternative?</p><h3 id="bringing&#95;back&#95;sanity">Bringing back sanity</h3><p>As a matter of a fact there is, almost any functional dynamic language does not require such wacky conversions, we can just work on the raw data:</p><pre><code class="clojure">&#40;defn service-a &#91;json&#93;
    &#40;-&gt; json parse process persist&#41;&#41;

; once parsed the person is a simple hashmap datastructure that we manipulate
&#40;defn process &#91;person&#93;
   &#40;assoc person :is-registered false&#41;&#41;
</code></pre><p>Oh wait, that is too simple your cheating!, what about type checking your code? making sure that its correct and all.</p><p>In the words of Rich Hickey:</p><blockquote><p>And I like to ask this question: What's true of every bug found in the field? </p></blockquote><blockquote><p>Audience reply: Someone wrote it? Audience reply: It got written. </p></blockquote><blockquote><p>It got written. Yes. What's a more interesting fact about it? It passed the type checker. </p></blockquote><p>With all that in mind there are cases where checking structure the data between components make sense.</p><p>Enter clojure.spec:</p><pre><code class="clojure">&#40;s/def ::name string?&#41;
&#40;s/def ::age integer?&#41;

&#40;s/def ::person &#40;s/keys :req &#91;::name ::age&#93;
</code></pre><p>This allows us to check the validity in run time and check that different parts of the system conform to the specifications of others.</p><h3 id="we&#95;have&#95;magic&#95;x&#95;that&#95;converts&#95;our&#95;types!">We have magic X that converts our types!</h3><p>There are "shorter" ways of converting types, such as:</p><ol><li>Code generation, we generate our types from a schema and don't write them, still you have code which isn't generate (the logic right?) and its bound to those multiple types increasing the maintenance cost, in addition you maintain a whole set of tools and schema so its not free.</li><li>Automated mapping libraries, similar to code generation you still have to maintain a huge set mapping between the types also the types themself don't go away you still have multiple types describing the same entity.</li><li>We work on the raw parsed data matching on the JSON:</li></ol><pre><code class="scala">class CC&#91;T&#93; {
  def unapply&#40;a:Option&#91;Any&#93;&#41;:Option&#91;T&#93; = if &#40;a.isEmpty&#41; {
    None
  } else {
    Some&#40;a.get.asInstanceOf&#91;T&#93;&#41;
  }
}

object M extends CC&#91;Map&#91;String, Any&#93;&#93;
object L extends CC&#91;List&#91;Any&#93;&#93;
object S extends CC&#91;String&#93;
object D extends CC&#91;Double&#93;
object B extends CC&#91;Boolean&#93;

for {
  M&#40;map&#41; &lt;- List&#40;JSON.parseFull&#40;jsonString&#41;&#41;
  L&#40;languages&#41; = map.get&#40;&quot;languages&quot;&#41;
  language &lt;- languages
  M&#40;lang&#41; = Some&#40;language&#41;
  S&#40;name&#41; = lang.get&#40;&quot;name&quot;&#41;
  B&#40;active&#41; = lang.get&#40;&quot;is&#95;active&quot;&#41;
  D&#40;completeness&#41; = lang.get&#40;&quot;completeness&quot;&#41;
} yield {
  &#40;name, active, completeness&#41;
}
</code></pre><p>Imagine this logic for n JSON documents in your system, it gets ugly pretty quickly.</p><h2 id="summary">Summary</h2><p>When using types and unstructured data be aware of the trade-offs, if your system deals with a huge variety of JSON/CSV or random HTML you will be spending a lot time in type conversion juggling not with the business logic itself.</p><p>Its hard to quantify but ~30% is not an exaggerated number from my experience in large Java projects, other languages with better type systems might get away with less but it still a considerable overhead.</p><h4 id="footnotes:">Footnotes:</h4><ul><li><small><a href='https://github.com/matthiasn/talk-transcripts/blob/master/Hickey_Rich/SimpleMadeEasy.md'>Simple Made easy</a>.</small></li><li><small><a href='http://dozer.sourceforge.net/'>Dozer</a> is an example for an "automated" bean to bean mapping framework.</small></li><li><small> How to parse JSON in <a href='https://stackoverflow.com/questions/4170949/how-to-parse-json-in-scala-using-standard-scala-classes'>Scala</a> using standard Scala classes?</small></li></ul>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/design/">design</a>
    
    <a href="/software/">software</a>
    
    <a href="/types/">types</a>
    
    <a href="/impedance/">impedance</a>
    
</div>

    
    <div id="comments">
        <a href="/posts/04-02-2018-types-mismatch/#disqus_thread">View Comments</a>
    </div>
    

    <div id="prev-next">
        
        
        
        <a href="/posts/17-01-2018-dependencies/">The balancing game &raquo;</a>
        
    </div>
</div>

			</div>
		    </div>

		    <div class="col-md-3">
			<div id="sidebar">
			  <ul id="links">

			    
			    <li><a href="/pages/about/">About</a></li>
			    
			  </ul>
			  <div id="recent">
			    <h3>Recent Posts</h3>
			    <ul>
				
				<li><a href="/posts/04-02-2018-types-mismatch/">When types are eating away your sanity</a></li>
				
				<li><a href="/posts/17-01-2018-dependencies/">The balancing game</a></li>
				
				<li><a href="/posts/16-04-2016-pi-crypt/">PI crypt</a></li>
				
			    </ul>
			  </div>
			  <div id="tags">
			    <h3>Tags</h3>
			    <ul>
				
				<li><a href="/js/">js</a></li>
				
				<li><a href="/security/">security</a></li>
				
				<li><a href="/dependencies/">dependencies</a></li>
				
				<li><a href="/raspberry/">raspberry</a></li>
				
				<li><a href="/encryption/">encryption</a></li>
				
				<li><a href="/cyanogenmod/">cyanogenmod</a></li>
				
				<li><a href="/wifi/">wifi</a></li>
				
				<li><a href="/design/">design</a></li>
				
				<li><a href="/asus/">asus</a></li>
				
				<li><a href="/opskeleton/">opskeleton</a></li>
				
				<li><a href="/tf101/">tf101</a></li>
				
				<li><a href="/management/">management</a></li>
				
				<li><a href="/software/">software</a></li>
				
				<li><a href="/linux/">linux</a></li>
				
				<li><a href="/types/">types</a></li>
				
				<li><a href="/pi/">pi</a></li>
				
				<li><a href="/Clojure/">Clojure</a></li>
				
				<li><a href="/vagrant/">vagrant</a></li>
				
				<li><a href="/concurrency/">concurrency</a></li>
				
				<li><a href="/future/">future</a></li>
				
				<li><a href="/impedance/">impedance</a></li>
				
				<li><a href="/android/">android</a></li>
				
				<li><a href="/raspberry-pi/">raspberry-pi</a></li>
				
				<li><a href="/nodejs/">nodejs</a></li>
				
			    </ul>
			  </div>
			</div>
		    </div>
		  </div>
		  <footer class="footer"><div class="span-24 small quite last">
			<span href="http://purl.org/dc/dcmitype/Text" property="dc:title" rel="dc:type" xmlns:dc="http://purl.org/dc/elements/1.1/"> This website content</span> by <a href="narkisr.com" property="cc:attributionName" rel="cc:attributionURL" xmlns:cc="http://creativecommons.org/ns#"> Ronen Narkis </a> is licensed under a <a href="http://creativecommons.org/licenses/by/2.5/il/" rel="license">Creative Commons Attribution 2.5 Israel License</a>, based on a work at <a href="narkisr.com" rel="dc:source" xmlns:dc="http://purl.org/dc/elements/1.1/">narkisr.com</a>, Permissions beyond the scope of this license may be available at <a href="narkisr.com" rel="cc:morePermissions" xmlns:cc="http://creativecommons.org/ns#">narkisr.com</a>.</div>
		  </footer>
		</div>
		<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
		<script src="js/highlight.pack.js" type="text/javascript"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	    </body>
	  </html>

